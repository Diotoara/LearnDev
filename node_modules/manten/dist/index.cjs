"use strict";var te=Object.defineProperty;var i=(e,t)=>te(e,"name",{value:t,configurable:!0});var se=require("node:events"),ne=require("node:util"),P=require("node:os"),re=require("expect");let b=!0;const w=typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{};let p=0;if(w.process&&w.process.env&&w.process.stdout){const{FORCE_COLOR:e,NODE_DISABLE_COLORS:t,NO_COLOR:n,TERM:r,COLORTERM:s}=w.process.env;t||n||e==="0"?b=!1:e==="1"||e==="2"||e==="3"?b=!0:r==="dumb"?b=!1:"CI"in w.process.env&&["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(o=>o in w.process.env)?b=!0:b=process.stdout.isTTY,b&&(process.platform==="win32"||s&&(s==="truecolor"||s==="24bit")?p=3:r&&(r.endsWith("-256color")||r.endsWith("256"))?p=2:p=1)}let M={enabled:b,supportLevel:p};function $(e,t,n=1){const r=`\x1B[${e}m`,s=`\x1B[${t}m`,o=new RegExp(`\\x1b\\[${t}m`,"g");return u=>M.enabled&&M.supportLevel>=n?r+(""+u).replace(o,r)+s:""+u}i($,"kolorist");const y=$(2,22),D=$(31,39),B=$(32,39),_=$(33,39),H=i(e=>Number.isFinite(e)?e:0,"toZeroIfInfinity");function oe(e){return{days:Math.trunc(e/864e5),hours:Math.trunc(e/36e5%24),minutes:Math.trunc(e/6e4%60),seconds:Math.trunc(e/1e3%60),milliseconds:Math.trunc(e%1e3),microseconds:Math.trunc(H(e*1e3)%1e3),nanoseconds:Math.trunc(H(e*1e6)%1e3)}}i(oe,"parseNumber");function ie(e){return{days:e/86400000n,hours:e/3600000n%24n,minutes:e/60000n%60n,seconds:e/1000n%60n,milliseconds:e%1000n,microseconds:0n,nanoseconds:0n}}i(ie,"parseBigint");function ce(e){switch(typeof e){case"number":{if(Number.isFinite(e))return oe(e);break}case"bigint":return ie(e)}throw new TypeError("Expected a finite number or bigint")}i(ce,"parseMilliseconds");const ae=i(e=>e===0||e===0n,"isZero"),ue=i((e,t)=>t===1||t===1n?e:`${e}s`,"pluralize"),le=1e-7,fe=24n*60n*60n*1000n;function k(e,t){const n=typeof e=="bigint";if(!n&&!Number.isFinite(e))throw new TypeError("Expected a finite number or bigint");t={...t};const r=e<0?"-":"";e=e<0?-e:e,t.colonNotation&&(t.compact=!1,t.formatSubMilliseconds=!1,t.separateMilliseconds=!1,t.verbose=!1),t.compact&&(t.unitCount=1,t.secondsDecimalDigits=0,t.millisecondsDecimalDigits=0);let s=[];const o=i((f,m)=>{const h=Math.floor(f*10**m+le);return(Math.round(h)/10**m).toFixed(m)},"floorDecimals"),u=i((f,m,h,d)=>{if(!((s.length===0||!t.colonNotation)&&ae(f)&&!(t.colonNotation&&h==="m"))){if(d??=String(f),t.colonNotation){const T=d.includes(".")?d.split(".")[0].length:d.length,S=s.length>0?2:1;d="0".repeat(Math.max(0,S-T))+d}else d+=t.verbose?" "+ue(m,f):h;s.push(d)}},"add"),c=ce(e),a=BigInt(c.days);if(t.hideYearAndDays?u(BigInt(a)*24n+BigInt(c.hours),"hour","h"):(t.hideYear?u(a,"day","d"):(u(a/365n,"year","y"),u(a%365n,"day","d")),u(Number(c.hours),"hour","h")),u(Number(c.minutes),"minute","m"),!t.hideSeconds)if(t.separateMilliseconds||t.formatSubMilliseconds||!t.colonNotation&&e<1e3&&!t.subSecondsAsDecimals){const f=Number(c.seconds),m=Number(c.milliseconds),h=Number(c.microseconds),d=Number(c.nanoseconds);if(u(f,"second","s"),t.formatSubMilliseconds)u(m,"millisecond","ms"),u(h,"microsecond","\xB5s"),u(d,"nanosecond","ns");else{const T=m+h/1e3+d/1e6,S=typeof t.millisecondsDecimalDigits=="number"?t.millisecondsDecimalDigits:0,ee=T>=1?Math.round(T):Math.ceil(T),A=S?T.toFixed(S):ee;u(Number.parseFloat(A),"millisecond","ms",A)}}else{const f=(n?Number(e%fe):e)/1e3%60,m=typeof t.secondsDecimalDigits=="number"?t.secondsDecimalDigits:1,h=o(f,m),d=t.keepDecimalsOnWholeSeconds?h:h.replace(/\.0+$/,"");u(Number.parseFloat(d),"second","s",d)}if(s.length===0)return r+"0"+(t.verbose?" milliseconds":"ms");const l=t.colonNotation?":":" ";return typeof t.unitCount=="number"&&(s=s.slice(0,Math.max(t.unitCount,1))),r+s.join(l)}i(k,"prettyMilliseconds");const g=`
`,de="    ",{log:v,error:L}=console,me=B("\u2714"),he=D("\u2716"),ge=_("\u2022"),be=y("\u25CB"),E=i(()=>{const e=new Date,t=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");return y(`${t}:${n}:${r}`)},"formatTimestamp"),q=i(({startTime:e,timeout:t,endTime:n})=>{const r=(n||Date.now())-e;let s=k(r);return t&&(s+=` / ${k(t)}`),r<50?"":` ${y(`(${s})`)}`},"prettyDuration"),ye=i(e=>e.replaceAll(/^/gm,de),"indentMultiline"),I=i((e,t=!0)=>{const{title:n,attempt:r,retry:s}=e;let o=`${n+q(e)}`;return t&&s>1&&(o+=y(` (${r}/${s})`)),o},"getTestTitle"),N=i((e,t,n)=>{let r=`${E()} ${he} ${I(e)}`;n&&(r+=` [${n}]`),L(r),L(`${ye(ne.inspect(t))}
`)},"logTestFail"),Te=i(e=>{v(`${E()} ${me} ${I(e)}`)},"logTestSuccess"),O=i(e=>{v(`${E()} ${be} ${I(e,!1)}`)},"logTestSkip"),we=i(e=>{if(e.length===0)return;const t=[];let n=0,r=0,s=0,o,u;for(const a of e)a.startTime&&(!o||o>a.startTime)&&(o=a.startTime),a.endTime===void 0?t.push(a):((!u||u<a.endTime)&&(u=a.endTime),a.error?r+=1:a.skip?s+=1:n+=1);let c="";if(t.length>0){for(const a of t)c+=`${g}${ge} ${a.title+q(a)}`;c+=g}c+=`${g}${y(k((u??Date.now())-o))}`,c+=g+(n>0?B:y)(`${n.toLocaleString()} passed`),r>0&&(c+=g+D(`${r.toLocaleString()} failed`)),s>0&&(c+=g+y(`${s.toLocaleString()} skipped`)),t.length>0&&(c+=g+_(`${t.length.toLocaleString()} pending`)),c+=g,v(c)},"logReport"),pe=i(()=>{let e,t;const n=new Promise((r,s)=>{e=r,t=s});return Object.assign(n,{resolve:e,reject:t})},"createDeferred"),Se=i((e,t)=>{const n=pe(),r=setTimeout(()=>{const s=new Error(`Timeout: ${e}ms`);t?.abort(s),n.reject(s)},e);return Object.assign(n,{timeoutId:r})},"setTimer"),j=i((e,t,n)=>{if(!e||!("then"in e)||t===void 0||t===0)return e;const r=Se(t,n);return Promise.race([e,r]).finally(()=>{clearTimeout(r.timeoutId)})},"timeLimitFunction"),V=i(e=>{const t=[];return{addHook:i(s=>{t.push(s)},"addHook"),runHooks:i(async(...s)=>{for(const o of t)try{await o(...s)}catch(u){await e(u)}},"runHooks")}},"createHook"),$e=i(async(e,t)=>{for(let n=1;n<=t;n+=1)try{await e(n);return}catch(r){if(n===t)throw r}},"retry");class Y extends Error{static{i(this,"SkipError")}constructor(t){super(t||"Test skipped"),this.name="SkipError"}}const W=i(e=>(e&&typeof e=="object"&&"matcherResult"in e&&e.constructor.name==="JestAssertionError"&&delete e.matcherResult,e),"patchJestAssertionError"),x=i(async(e,t)=>{const{testFunction:n,timeout:r}=e,s=V(c=>{N(e,c,"onTestFail")}),o=i(async c=>{await s.runHooks(c)},"handleError"),u=V(async c=>{N(e,W(c),"onTestFinish")});try{await $e(async c=>{e.attempt=c,e.startTime=Date.now();const a=new AbortController;let l;t&&(l=i(()=>{a.signal.aborted||a.abort(t.abortController.signal.reason)},"handleParentAbort"),t.abortController.signal.addEventListener("abort",l),t.abortController.signal.aborted&&l());try{await j(n({signal:a.signal,onTestFail:s.addHook,onTestFinish:u.addHook,skip:i(f=>{throw new Y(f)},"skip")}),r,a),Te(e)}catch(f){if(f instanceof Y)e.skip=!0,O(e);else throw N(e,W(f)),await o(f),f}finally{t&&l&&t.abortController.signal.removeEventListener("abort",l),a.signal.aborted||a.abort(),await u.runHooks(),e.endTime=Date.now()}},e.retry)}catch(c){e.error=c,process.exitCode=1}},"runTest"),G=[];process.on("exit",()=>{we(G)});const U=process.env.TESTONLY,J=i((e,t)=>((n,r,s)=>{if(e&&(n=`${e} ${n}`),t&&(t.testsStarted=!0),U&&!n.includes(U))return Promise.resolve();const o={title:n,testFunction:r,retry:1};if(s!==void 0&&(typeof s=="number"?o.timeout=s:(o.timeout=s?.timeout,s?.retry&&(o.retry=s?.retry))),G.push(o),t?.skipped){o.skip=!0,o.skipReason=t.skipReason;const u=Date.now();return o.startTime=u,o.endTime=u,O(o),Promise.resolve()}return(async()=>{const c=i(async()=>{if(t?.concurrencyLimiter){const a=await t.concurrencyLimiter.acquire();try{await x(o,t)}finally{a()}}else await x(o,t)},"executeTest")();t&&t.pendingTests.push(c),await c})()}),"createTest"),Le=i(async e=>{for(;e.length>0;){const t=e.splice(0);await Promise.all(t)}},"waitAllPromises"),De=i(e=>("default"in e&&(e=e.default),"default"in e&&(e=e.default),e),"unwrapModule"),R=i(e=>{let t=typeof e=="number"?e:Z(),n=0;const r=[];let s;return e==="auto"&&(s=setInterval(()=>{const a=Z();if(a!==t)for(t=a;r.length>0&&n<t;){const l=r.shift();l&&(n+=1,l())}},5e3),s.unref()),{acquire:i(()=>n<t?(n+=1,Promise.resolve(()=>{n-=1;const a=r.shift();a&&(n+=1,a())})):new Promise(a=>{r.push(()=>{a(()=>{n-=1;const l=r.shift();l&&(n+=1,l())})})}),"acquire"),setLimit:i(a=>{for(t=a;r.length>0&&n<t;){const l=r.shift();l&&(n+=1,l())}},"setLimit"),cleanup:i(()=>{s&&clearInterval(s)},"cleanup")}},"createSemaphore"),Z=i(()=>{const e=P.cpus().length,t=P.loadavg()[0];return Math.max(1,Math.min(Math.floor(e*(1-Math.min(t/e,.8))),e))},"calculateAutoLimit"),z=i((e,t)=>((n,r,s)=>(e&&(n=`${e} ${n}`),t&&(t.testsStarted=!0),(async()=>{const o=F(n,s?.parallel,s?.timeout);await i(async()=>{if(t?.concurrencyLimiter){const c=await t.concurrencyLimiter.acquire();try{await o.run(r,t)}finally{c()}}else await o.run(r,t)},"executeDescribe")()})())),"createDescribe"),K=i((e,t)=>((n,...r)=>{t&&(t.testsStarted=!0);const s=i(()=>{const o=F(e);return o.run(async()=>De(await n).apply(o,r),t)},"executeTestSuite");return t?.concurrencyLimiter?t.concurrencyLimiter.acquire().then(o=>s().finally(o)):s()}),"createRunTestSuite"),Q=J(),X=z(),C=K(),F=i((e,t,n)=>{let r;t!==void 0&&(t===!0?r=void 0:t===!1?r=R(1):typeof t=="number"?r=R(t):t==="auto"&&(r=R("auto")));const s=new AbortController;se.setMaxListeners(0,s.signal);const o={pendingTests:[],callbacks:{onFinish:[]},concurrencyLimiter:r,abortController:s,timeout:n,skipped:!1,skipReason:void 0,testsStarted:!1,run:i(async(u,c)=>{c?.skipped&&(o.skipped=!0,o.skipReason=c.skipReason);let a;c&&(a=i(()=>{s.signal.aborted||s.abort(c.abortController.signal.reason)},"handleParentAbort"),c.abortController.signal.addEventListener("abort",a),c.abortController.signal.aborted&&a());try{const l=(async()=>{await u(o.api),await Le(o.pendingTests)})();c&&c.pendingTests.push(l),await j(l,n,s)}catch(l){L(l),process.exitCode=1}finally{c&&a&&c.abortController.signal.removeEventListener("abort",a),s.signal.aborted||s.abort(),r&&r.cleanup();for(const l of o.callbacks.onFinish)try{await l()}catch(f){L(f),process.exitCode=1}}},"run")};return o.api={signal:s.signal,test:e?J(`${e} \u203A`,o):Q,describe:e?z(`${e} \u203A`,o):X,runTestSuite:e?K(e,o):C,onFinish:i(u=>{o.callbacks.onFinish.push(u)},"onFinish"),skip:i(u=>{if(o.testsStarted)throw new Error("skip() must be called before any tests or nested describes run. Move skip() to the beginning of the describe callback.");o.skipped=!0,o.skipReason=u},"skip")},o},"createContext"),ke=F(),ve=i((e,t,n)=>{const r=typeof e=="string"?e:void 0,s=typeof e=="string"?t:e,o=typeof e=="string"?n:void 0;return i(async function(...c){const a=this||ke;r?await a.api.describe(r,l=>s(l,...c),o):await s(a.api,...c)},"testSuiteWrapper")},"testSuite"),Ee=i(e=>{setTimeout(()=>{process.exitCode=1,console.error(D(`\u2716 Process timed out after ${e}ms`)),setImmediate(()=>process.exit(1))},e).unref()},"setProcessTimeout");Object.defineProperty(exports,"expect",{enumerable:!0,get:i(function(){return re.expect},"get")}),exports.describe=X,exports.runTestSuite=C,exports.setProcessTimeout=Ee,exports.test=Q,exports.testSuite=ve;
